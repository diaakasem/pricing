{"version":3,"sources":["../src/index.js"],"names":["PackagePricing","utils","peopleToReachSinglePayer","buyUSD","sellUSD","priceBase","deliveryFees","payfortPercentage","payfortConstInUSD","taxes","additionalTaxes","saftyMargin","fbPayPerImpression","plivoSMSUSD","defaultRoundingBase","amount","payfortConst","payfortVariable","ret","fbAdPerAccount","log","SMSFees","smsCostUntilWeGetToABuyer","Math","round","packageIndex","users","months","roundingBase","priceInEgp","savingInEgp","savingPercent","priceInUsd","index","roundBase","mround","usdRoundBase","basePackagePrice","netPrice","withSaftey","calcTaxes","additionalFees","withAcquisition","transfereFees","calcPayFortFees","gross","price","originalPriceInUsd","baseSavingPrice","singleUserPaysMonthly","singleUserPaysAnnually","youSave"],"mappings":"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","file":"index.js","sourcesContent":["'use strict';\n\nimport Utils from './utils';\n\nexport default class PackagePricing {\n\n    constructor() {\n        //DEBUG\n        this.utils = new Utils(true, 25);\n        // Based on the 80/20 rule .. doubled\n        this.peopleToReachSinglePayer = 25;\n        // Price per 1 USD in EGP\n        this.buyUSD = 18;\n        this.sellUSD = 17;\n        // The Very Base Price\n        this.priceBase = 13;\n        // The money transfer fees\n        this.deliveryFees = 10;\n        // is the share that payfort takes  2.65 %\n        this.payfortPercentage = 0.0265;\n        this.payfortConstInUSD = 0.14;\n        // Taxes\n        this.taxes = 0.22;\n        this.additionalTaxes = 0.14;\n        // Set Safty Margin .. in case we miss something\n        this.saftyMargin = 0.1;\n        // Acquisition by Facebook Ads\n        this.fbPayPerImpression = 0.00734;\n        // Using Plivo in usd\n        this.plivoSMSUSD = 0.035;\n        // Default rounding base - will be multiplied by 10\n        this.defaultRoundingBase = 5;\n    }\n\n    /**\n     * Calculates the payfort fees used to transfer money from user's CC to\n     * company's bank account\n     * @param {Number} amount The amount in EGP\n     * @return {Number} The payfort fees per amount in EGP\n     */\n    calcPayFortFees(amount) {\n        // The constant that payfort takes in USD\n        let payfortConst = this.payfortConstInUSD * this.buyUSD;\n        let payfortVariable = this.payfortPercentage * amount;\n        return payfortVariable + payfortConst;\n    }\n\n    /**\n     * Calculates the taxes\n     * @param {Number} amount The amount of money to calculate taxes on\n     * @return {Number} The amount of money, with taxes considered ( added )\n     */\n    calcTaxes(amount) {\n        let ret = amount * this.taxes + amount * this.additionalTaxes;\n        return ret;\n    }\n\n    /**\n     * Calculate additional fees per user for acquisition\n     * @return fixed number based on the plivoSMS rate and fbAd rate\n     */\n    additionalFees() {\n        let fbAdPerAccount = this.fbPayPerImpression * this.peopleToReachSinglePayer * this.buyUSD;\n        this.utils.log(\"FB Ad per Account\", fbAdPerAccount);\n        let SMSFees = this.plivoSMSUSD * this.buyUSD;\n        let smsCostUntilWeGetToABuyer = SMSFees * this.peopleToReachSinglePayer;\n        this.utils.log(\"SMS Cost per Buyer\", smsCostUntilWeGetToABuyer);\n        return Math.round(fbAdPerAccount + smsCostUntilWeGetToABuyer);\n    }\n\n    /**\n     * @param {Number} packageIndex 0 ( free ) 1 ( basic ) 2 ( advanced ) 3 ( extreme )\n     * each packageIndex has more features than the ones before\n     * @param {Number} users Buying for how many users. must be > 0\n     * @param {Number} months 1 -to- 12\n     * @return {Number} The price\n     */\n    price(packageIndex, users, months, roundingBase) {\n        // Free Package\n        if (packageIndex === 0) {\n            return {\n                priceInEgp: 0,\n                savingInEgp: 0,\n                savingPercent: 0,\n                priceInUsd: 0\n            };\n        }\n        this.utils.log('Arguments', {\n            index: packageIndex,\n            users: users,\n            months: months\n        });\n        // Pricing rounding base\n        let roundBase = this.utils.mround(this.priceBase, 10) * (roundingBase || this.defaultRoundingBase);\n        // USD Pricing rounding base\n        let usdRoundBase = 3;\n        this.utils.log('Round Base', roundBase);\n        let basePackagePrice = packageIndex * this.priceBase;\n        this.utils.log('Base Package Price', basePackagePrice);\n        let netPrice =  basePackagePrice * months * users ;\n        this.utils.log('Net Price', netPrice);\n        let withSaftey = netPrice + (netPrice * this.saftyMargin);\n        this.utils.log('With Saftey', withSaftey);\n        let taxes = this.calcTaxes(withSaftey);\n        this.utils.log('Taxes', taxes);\n        this.utils.log('Additional Fees', this.additionalFees());\n        let withAcquisition = this.additionalFees() + taxes + withSaftey;\n        this.utils.log('With Acquisition', withAcquisition);\n        let transfereFees = this.calcPayFortFees(withAcquisition);\n        this.utils.log('Transfere Fees', transfereFees);\n        let gross = withAcquisition + transfereFees;\n        this.utils.log('Gross', gross);\n        let price = this.utils.mround(gross + (roundBase / 2), roundBase);\n        this.utils.log('Price', price);\n        let originalPriceInUsd = price / this.sellUSD;\n        this.utils.log('Original Price In USD', originalPriceInUsd);\n        let priceInUsd = this.utils.mround(originalPriceInUsd + (usdRoundBase/2), usdRoundBase);\n        this.utils.log('Price In USD', priceInUsd);\n        let baseSavingPrice = this.utils.mround(roundBase + (roundBase / 2), roundBase) * 12;\n        if (!(users === 1 && months === 1 && packageIndex === 1)) {\n            baseSavingPrice = this.price(1, 1, 1).priceInEgp * 12;\n        }\n        this.utils.log('Base Savinig Price', baseSavingPrice);\n        let singleUserPaysMonthly = (price / users) / months;\n        this.utils.log('Single User Pays Monthly', singleUserPaysMonthly);\n        let singleUserPaysAnnually = singleUserPaysMonthly * 12;\n        this.utils.log('Single User Pays Annually', singleUserPaysAnnually);\n        let youSave = baseSavingPrice - singleUserPaysAnnually ;\n        this.utils.log('You Save', youSave);\n        let savingPercent = youSave/(singleUserPaysAnnually + youSave)\n        this.utils.log('Saving Percent', savingPercent);\n        return {\n            priceInEgp: price,\n            priceInUsd: priceInUsd,\n            savingInEgp: youSave,\n            savingPercent: savingPercent,\n        };\n    };\n};\n"]}